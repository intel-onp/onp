---
kolla_internal_vip_address: "{{ kolla_internal_vip_address }}"
kolla_external_vip_address: "{{ kolla_external_vip_address }}"
{% for group in ['control', 'network'] if group in groups %}
{% if kolla_internal_vip_address|string() != kolla_external_vip_address|string() %}
kolla_external_vip_interface: {{ node_info[groups[group][0]].networks['inter'].interface }}
{% endif %}
{% endfor %}

kolla_base_distro: "{{ kolla_base_distro }}"
kolla_install_type: "{{ kolla_install_type }}"
docker_registry: "{{ docker_registry }}"
docker_namespace: "{{ docker_namespace }}"
openstack_release: "{{ openstack_release }}"
openstack_logging_debug: "{{ openstack_logging_debug|default(False) }}"

docker_common_options:
    environment:
      KOLLA_CONFIG_STRATEGY: "{{ kolla_config_strategy }}"
      OS_PROJECT_DOMAIN_NAME: "default"
      OS_USER_DOMAIN_NAME: "default"
      OS_PROJECT_NAME: "admin"
      OS_TENANT_NAME: "admin"
      OS_USERNAME: "admin"
      OS_PASSWORD: "{{ keystone_admin_password }}"
      OS_AUTH_URL: "http://{{ kolla_internal_vip_address }}:35357/v3"
      OS_IDENTITY_API_VERSION: "3"
      {% if proxy_env %}
{{ proxy_env|to_yaml(indent=6, default_flow_style=False)|indent(6, false) }}
      {% endif %}

{% set var = { 'public_inter' : "dummy1" } %}
{% for group in ['control', 'network'] if group in groups and "public" in node_info[groups[group][0]].networks %}
{% if var.update({ 'public_inter' : node_info[groups[group][0]].networks['public'].interface }) %} {% endif %}
{% endfor %}
neutron_external_interface: "{{ var.public_inter }}"

{% if ovs_type == "ovs-dpdk" %}
ovs_datapath: "netdev"
{% endif %}

{% if use_ceilometer %}
enable_ceilometer: "yes"
enable_mongodb: "yes"
enable_collectd: "yes"
{% endif %}

{% if use_cinder %}
enable_cinder: "yes"
{% if cinder_backend == "nfs" %}
enable_cinder_backend_nfs: "yes"
{% elif cinder_backend == "lvm" %}
enable_cinder_backend_lvm: "yes"
cinder_volume_group: "cinder-volumes"
{% endif %}
{% endif %}

{% if use_magnum %}
enable_magnum: "yes"
{% endif %}

{% if use_swift %}
enable_swift: "yes"
glance_backend_swift: "yes"
swift_devices_match_mode: "strict"
swift_devices_name: "KOLLA_SWIFT_DATA"
{% endif %}

{% if use_neutron_lbaas or use_kuryr_kubernetes|default(False) %}
enable_neutron_lbaas: "yes"
{% endif %}

node_info:
  {{ node_info|to_yaml(indent=2, default_flow_style=False)|indent(2, false) }}
